<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compiler</title>
    <style>
      #code {
        width: 600px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <div><select id="select"></select></div>
    <div>
      <textarea id="code">
var a = "a";
/**
  * @param {number} x
  * @param {number} y
  */
function add(x, y) {
  return x + y;
}
var cond = add(1, 2 * 3);
log(cond);
if (cond) {
  a = "b";
} else {
  a = "c";
}
log(a);

function makeCounter() {
  var i = 0;
  function count() {
    i = i + 1;
    log(i);
  }

  return count;
}

var counter = makeCounter();
counter();
counter();
var n = 1;
++n;
log(n);
--n;
log(n);
function fib(n) {
  if (n <= 1) return n;
  return fib(n-1) + fib(n-2);
}
log(fib(20));
var globalA = "global";
{
  function showA() {
    log(globalA);
  }

  showA();
  var globalA = "block";
  showA();
}
       </textarea
      >
    </div>
    <div>
      <button id="run">run</button>
    </div>
    <div id="result"></div>
    <script src="./jsjs.umd.js"></script>
    <script>
      window.onload = function () {
        const textareaDom = document.querySelector('#code');
        const buttonDom = document.querySelector('#run');
        const resultDom = document.querySelector('#result');
        window.localStorage.setItem('debug', '*');

        buttonDom.addEventListener('click', function () {
          const text = (textareaDom && textareaDom.value) || '';
          const { Jsjs, Environment, Log } = window.jsjs;
          const interpreter = new Jsjs(text, new Environment(null));
          const log = new Log();
          let resultList = [];
          log.log = (result) => {
            resultList = result;
          };
          interpreter.register('log', log);
          const result = interpreter.run();
          if (interpreter.errors.length > 0) {
            resultDom.innerHTML =
              interpreter.errors
                .map((item) => `<div>error: ${item}</div>`)
                .join('') + resultDom.innerHTM;
          } else {
            console.log(...resultList);
            console.log(result);
            resultDom.innerHTML += resultList
              .map((item) => `<div>log: ${item}</div>`)
              .join('');
          }
        });
      };
    </script>
  </body>
</html>
